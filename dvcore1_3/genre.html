<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../dvcore4_6/page5.css">
    <title>Genre Info</title>

    <style>
        .stop-left {
            stop-color: #3f51b5;  /* Indigo */
        }

        .stop-right {
            stop-color: #009688;  /* Teal */
        }

    </style>

</head>

<body>

  <header>
      <!-- logo -->
      <h1 class="logo"><a href="../index.html">MovieInvest</a></h1>
      <ul>
          <li><a href="../dvcore1_3/genre.html">Genre</a></li>
          <li><a href="../dvcore1_3/actor_new.html">Actor</a></li>
          <li><a href="../dvcore1_3/country.html">Country</a></li>
          <li><a href="../dvcore4_6/dvcore4New.html">Content</a></li>
          <li><a href="../dvcore4_6/dvcore5New.html">Director</a></li>
          <li><a href="../dvcore4_6/dvcore6New.html">Publish Quarter</a></li>
      </ul>
  </header>
  <section class = "dataVisCore">
      <div class = "chartContainer glassmorphic-element" id = "chartContainer" >
          <div id = "plot" class = "chart "></div>
          <div class = "pageGuide">
              <h2>Which genre is suitable for your movie investment?</h2>
                  <p>From the dataset, we can notice that, </p>
                  <p>In this chart, we present you a bar chart, with horizontal axis showing the actors' name, and vertical axis as the average profit of the actors' movie.</p>
              <h2>How this page works</h2>
                  <p>buttons on the left side are used to control the presence of chart</p>
                  <p>navigation bar on the top can guide you to pages of your interest</p>
                  <p>if you want to know more about what movies are published in each time slot, you can hover the mouse over the bar to check the posters of movies published during that period.</p>
          </div>
      </div>
  </section>

<div id = 'main'>
  <style>
    .inBlue { color: CornflowerBlue; }
  </style>

  <!--<h3 class="inBlue">Genre Infomation</h3>-->

  <!-- Load d3.js -->
  <script src="https://d3js.org/d3.v4.js"></script>

  <!-- Create a div where the graph will take place -->
  <!--<div id="genre_data"></div>-->


  <script>

  // set the dimensions and margins of the graph
  var margin = {top: 80, right: 10, bottom: 50, left: 70},
    width = 900 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;

  // append the svg object to the body of the page
  var svg = d3.select("#plot")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");


  // Parse the Data
  d3.csv("https://raw.githubusercontent.com/liliwang97/liliwang97.github.io/main/df_genre.csv", function(data) {

    var genres = [];
    for (var i = 0; i < data.length; i++) {
        genres.push(data[i].genre);
    }

    //console.log(genres)

    // Color scale: give me a specie name, I return a color
    var color = d3.scaleOrdinal()
      .domain(genres)
      .range(["#BEDB39","#8BC34A","#43A047","#289976","#287D7D",
              "#A8C545","#588F27","#66BB6A","#1F8A70","#BDD684",
              "#689F38","#2E7D32","#1BBC9B","#95AB63","#45BF55",
              "#00A388","#A9CF54","#BEEB9F","#79BD8F","#00796B"])

    /*var color = d3.scaleLinear()
      .domain(genres)
      .range(["#440154ff", "#21908dff"])
      .interpolate(d3.interpolateLab);
    */

    // Extract the list of dimensions
    dimensions = d3.keys(data[0])
  //  dimensions = [1,4,6,8,10,12].map(x=>dimensions[x]);
    dimensions = [5,6,7,8,9,10,11,12].map(x=>dimensions[x]);

    // build linear scale for each dimension
    // except the first, it's ordinal scale
    // store all in a y object
    var y = {}
    for (i in dimensions) {
      name = dimensions[i]
      if (false){}
    /*  if (name === "genre"){
        y[name] = d3.scaleOrdinal()
          .domain( d3.extent(data, function(d) { return d[name]; }) )
          .range([height, 450, 425, 400, 375, 350, 325, 300, 275, 250, 225, 200, 175, 150, 125, 100, 75, 50, 25, 0])
      }*/
      else{
        y[name] = d3.scaleLinear()
          .domain( d3.extent(data, function(d) { return +d[name]; }) )
          .range([height, 0])
      }

    }

    // build the X scale
    // find the best position for each Y axis
    x = d3.scalePoint()
      .range([0, width])
      .padding(1)
      .domain(dimensions);

    // Highlight the specie that is hovered
    var highlight = function(d){

      selected_genre = d.genre
      Tooltip
        .style("opacity", 1)
        .html("This genre is: " + selected_genre)
        .style("left", (d3.mouse(this)[0]) + "px")
        .style("top", (d3.mouse(this)[1]) + "px")

      // first every group turns grey
      d3.selectAll(".line")
        .transition().duration(200)
        .style("stroke", "lightgrey")
        .style("opacity", "0.2")

      // Second the hovered specie takes its color
      d3.selectAll("." + selected_genre)
        .transition().duration(200)
        .attr("stroke-width", 6)
        .style("stroke", color(selected_genre))
        .style("opacity", "1")
    }

    // Unhighlight
    var doNotHighlight = function(d){
      Tooltip
        .style("opacity", 0)
      d3.selectAll(".line")
        .transition().duration(200).delay(1000)
        .style("stroke", function(d){ return( color(d.genre))} )
        .style("opacity", "1")
    }

    // input: a row of the csv
    // return: x and y coordinates of the line to draw
    function path(d) {
        return d3.line()(dimensions.map(function(p) { return [x(p), y[p](d[p])]; }));
    }

    // Add tip box
    var Tooltip = d3.select("#genre_data")
      .append("div")
      .style("opacity", 1)
      .attr("class", "tooltip")
      .style("background-color", "white")
      .style("border", "solid")
      .style("border-width", "2px")
      .style("border-radius", "5px")
      .style("padding", "5px")
      .style("position", "absolute")

    // Draw the lines
    svg
      .selectAll("myPath")
      .data(data)
      .enter()
      .append("path")
      .attr("class", function (d) { return "line " + d.genre } )
      .attr("d",  path)
      .style("fill", "none")
      .attr("stroke-width", 3)
      .style("stroke", function(d){ return( color(d.genre))} )
      .style("opacity", 0.5)
      .on("mouseover", highlight)
      .on("mouseleave", doNotHighlight )

    // Draw the axis
    svg.selectAll("myAxis")
      // Add "g" for each dimension
      .data(dimensions).enter()
      .append("g")
        .style("fill", "MidnightBlue")
      // translate this element to its right position on the x axis
      .attr("transform", function(d) { return "translate(" + x(d) + ")"; })
      // build the axis with the call function
      .each(function(d) { d3.select(this).call(d3.axisLeft().ticks(5).scale(y[d])); })
      // add axis title
      .append("text")
        .style("text-anchor", "middle")
        .attr("y", 420)
        .attr("x", -220)
        .text(function(d) { return d; })
        .style("fill", "MidnightBlue")
        .attr("transform", "translate(-10,0)rotate(-30)")
        .style("font-size", "12px")
        .style("font-weight", "bold")

  })


  </script>

</div>
</body>
</html>
