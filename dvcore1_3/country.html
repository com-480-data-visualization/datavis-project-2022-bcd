<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../dvcore4_6/page5.css">
    <title>Country Info</title>
    <style>
      .inBlue { color: CornflowerBlue; }
    </style>  
</head>

<body>

  <header>
      <!-- logo -->
      <h1 class="logo"><a href="../index.html">MovieInvest</a></h1>
      <ul>
          <li><a href="../dvcore1_3/genre.html">Genre</a></li>
          <li><a href="../dvcore1_3/actor_new.html">Actor</a></li>
          <li><a href="../dvcore1_3/country.html">Country</a></li>
          <li><a href="../dvcore4_6/dvcore4New.html">Content</a></li>
          <li><a href="../dvcore4_6/dvcore5New.html">Director</a></li>
          <li><a href="../dvcore4_6/dvcore6New.html">Publish Quarter</a></li>
      </ul>
  </header>
  <section class = "dataVisCore">
      <div class = "chartContainer glassmorphic-element" id = "chartContainer" >
          <div id = "plot" class = "chart "></div>
          <div class = "pageGuide">
              <h2>Which country is suitable for your movie investment?</h2>
                  <p>From the dataset, we can notice that, </p>
                  <p>In this chart, we present you a bar chart, with horizontal axis showing the actors' name, and vertical axis as the average profit of the actors' movie.</p>
              <h2>How this page works</h2>
                  <p>buttons on the left side are used to control the presence of chart</p>
                  <p>navigation bar on the top can guide you to pages of your interest</p>
                  <p>if you want to know more about what movies are published in each time slot, you can hover the mouse over the bar to check the posters of movies published during that period.</p>
          </div>
      </div>
      <ul class = "controls">
          <li onclick="next_chart();"></li>
          <li onclick="next_chart();"></li>
      </ul>
  </section>
  <div id="tooltip_country" class="tooltip glassmorphic-element">
    <ul class = "tooltip-img-container">
      <li>
          <div class="tooltip-image"><img id = "img1"></img></div>
          <div class="tooltip-mtitle"><p id="mtitle1"></p></div>
      </li>
      <li>
          <div class="tooltip-image"><img id = "img2"></img></div>
          <div class="tooltip-mtitle"><p id="mtitle2"></p></div>
      </li>
    </ul>
    <button class="tooltip-button" id = "close">x</button>
  </div>

<div class="lArrowContainer" onclick="location.href='./genre.html'">
    <div class="arrow--left"></div>
    <span>Actor</span>
</div>

<div class="rArrowContainer" onclick="location.href='../dvcore4_6/dvcore4New.html'">
    <div class="arrow--right"></div>
    <span>Content</span>
</div>
  <!--<h3 class="inBlue">Country Infomation</h3>-->

  <!-- Load d3.js -->
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>

  <!-- Create an element where the map will take place -->
  <svg id="my_country" width="1000" height="500"></svg>

  <script>

  var margin = {top: 80, right: 10, bottom: 50, left: 70},
    width = 900 - margin.left - margin.right,
    height = 600 - margin.top - margin.bottom;

  // append the svg object to the body of the page
  var svg = d3.select("#plot")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

  // Map and projection
  var path = d3.geoPath();
  var projection = d3.geoMercator()
    .scale(70)
    .center([0,20])
    .translate([width / 2, height / 2]);

  // Data and color scale
  var data = d3.map();
  var colorScale = d3.scaleThreshold()
    .domain([-1000000, -10000, 0, 10000, 100000, 1000000, 10000000, 50000000, 100000000, 300000000])
    .range(d3.schemeGnBu[9]);

  // Load external data and boot
  d3.queue()
    .defer(d3.json, "https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson")
    .defer(d3.csv, "https://raw.githubusercontent.com/liliwang97/liliwang97.github.io/main/df_country_code.csv", function(d) { data.set(d.code, +d.avg_global_profit, +d.country, +d.poster); })
    .await(ready);

  // Add tip box
  var Tooltip = d3.select("#chartContainer")
    .append("div")
    .style("opacity", 0)
    .attr("class", "tooltip")



  function ready(error, topo) {
    var mouseover = function(d) {

      var selected_country = d.country;
      console.log(selected_country)

      Tooltip
        .style("opacity", 1)
        .html(selected_country)
        .style("z-index","100")

      Tooltip
        .style("transform", `translate(`
              + `calc(${width-2*margin.left}px),`
              + `calc(${height/2.25}px)`
              + `)`);


      d3.selectAll(".Country")
        .transition()
        .duration(200)
        .style("opacity", 0.5)
      d3.select(this)
        .transition()
        .duration(200)
        .style("opacity", 1)
        .style("stroke", "black")
    };

    var mouseleave = function(d) {
      Tooltip
        .style("opacity", 0)
      d3.selectAll(".Country")
        .transition()
        .duration(200)
        .style("opacity", .8)
      d3.select(this)
        .transition()
        .duration(200)
        .style("stroke", "transparent")
    };

    // Draw the map
    svg.append("g")
      .selectAll("path")
      .data(topo.features.filter(d => d.id !== "GRL" && d.id !== "ATA"))
      //.data(topo.features)
      .enter()
      .append("path")
        // draw each country
        .attr("d", d3.geoPath()
          .projection(projection)
        )
        // set the color of each country
        .attr("fill", function (d) {
          d.total = data.get(d.id) || 0;
          return colorScale(d.total);
        })
        .style("stroke", "transparent")
        .attr("class", function(d){ return "Country" } )
        .style("opacity", .8)
        .on("mouseover", mouseover )
        .on("mouseleave", mouseleave );

      }


  </script>
</body>
</html>
